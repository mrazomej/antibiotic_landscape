---
editor:
    render-on-save: true
bibliography: references.bib
csl: ieee.csl
---

## Alternative Metropolis-Kimura Evolutionary Dynamics {#sec-metropolis-kimura}

In the main text, we described a simple algorithm for evolving a population as a
biased random walk on a phenotypic space controlled by both a fitness function
and a genotype-phenotype density function. Here, we propose an alternative
algorithm that combines elements of the Metropolis-Hastings algorithm with
Kimura's classical population genetics theory.

### Metropolis-Kimura Algorithm

In @sec-metropolis, we described a simple framework with a fitness function and
a genotype-phenotype density function. Here, we use the same framework but
introduce a biologically motivated algorithm for the evolutionary dynamics that
combines elements of the Metropolis-Hastings algorithm with Kimura's classical
population genetics theory. This approach implements a two-step process that
separately models:

1. The probability of mutation occurring (mutation accessibility) as governed by the genotype-phenotype density.
2. The probability of fixation within a population (selection) determined by the fitness effect of such mutation and the effective population size.

#### Biological Motivation

In natural populations, evolution proceeds through two distinct processes:

1. **Mutation**: New variants arise through random genetic changes. The probability of specific mutations depends on molecular mechanisms and constraints of the genotype-phenotype map.

2. **Fixation**: Once a mutation occurs, it must spread through the population to become fixed. The probability of fixation depends on the selection coefficient (fitness advantage) and the effective population size.

#### Mathematical Framework

##### Mutation Probability

The probability of a mutation from phenotype $\underline{x}$ to $\underline{x}'$ is modeled using a Metropolis-like criterion based on the genotype-phenotype density:

$$
\pi_{\text{mut}}(\underline{x} \to \underline{x}') = 
\min\left(1, \left(\frac{GP(\underline{x}')}{GP(\underline{x})}\right)^{\beta}\right)
$${#eq-mutation-probability}

Here, $GP(\underline{x})$ represents the genotype-phenotype density at phenotype $\underline{x}$, and $\beta$ is a parameter controlling the strength of mutational constraints. The higher $\beta$ is, the less likely a mutation going downhill in genotype-phenotype density is to be accepted.

##### Kimura's Fixation Probability

Once a mutation occurs, its probability of fixation in a population of effective size $N$ is given by Kimura's formula

$$
\pi_{\text{fix}}(\underline{x} \to \underline{x}') = 
\frac{1 - e^{-2s}}{1 - e^{-2Ns}}
$${#eq-kimura-fixation-probability}

where $s$ is the selection coefficient. We compute this selection coefficient as the difference in fitness between the new and old phenotype divided by the fitness of the old phenotype:

$$
s = \frac{F_E(\underline{x}') - F_E(\underline{x})}{F_E(\underline{x})}
$${#eq-selection-coefficient}

This equation captures a fundamental result from population genetics: beneficial mutations ($s > 0$) have a higher probability of fixation, with the probability approaching $2s$ for small positive selection coefficients and approaching 1 for large positive selection coefficients. Deleterious mutations ($s < 0$) have an exponentially decreasing probability of fixation as population size increases.

#### Overall Acceptance Probability

The overall acceptance probability—defined as the probability of a proposed step $\underline{x} \rightarrow \underline{x}'$—is the product of the mutation probability and the fixation probability:

$$
\pi_{\text{accept}}(\underline{x} \to \underline{x}') = 
\pi_{\text{mut}}(\underline{x} \to \underline{x}') \cdot 
\pi_{\text{fix}}(\underline{x} \to \underline{x}')
$${#eq-overall-acceptance-probability}

This two-step process better reflects the biological reality of evolution, where both mutational accessibility and selection contribute to evolutionary trajectories.

### Effect of Population Size

@fig-metropolis-population-effect shows the effect of population size parameter
$N$ influences evolutionary trajectories in our Metropolis-Kimura framework.
Through a series of panels showing both phenotypic trajectories (upper) and
fitness dynamics (lower), we can observe how different population sizes affect
the balance between exploration and exploitation in phenotypic space.

At small population sizes (left panels), the evolutionary trajectories exhibit
highly stochastic behavior, with populations taking meandering paths through the
phenotypic landscape. This represents a regime where genetic drift plays a
dominant role. As population size increases (moving right), the trajectories
become increasingly deterministic, with populations taking more direct paths
toward fitness peaks, while avoiding genotype-to-phenotype density valleys. This
transition reflects a shift from drift-dominated to selection-dominated
dynamics, where populations more strictly follow the local fitness gradient. The
fitness trajectories in the lower panels further reinforce this pattern, showing
more erratic fitness fluctuations at small population sizes and more monotonic
increases at large population sizes, consistent with stronger selective
pressures.

![**Effect of population size on adaptive dynamics**. Upper panels:
Population trajectories on a landscape with a single fitness peak and four
genotype-phenotype density peaks. Black dashed lines indicate fitness landscape
contours, while white solid lines show genotype-phenotype density contours.
Colored lines represent independent population trajectories, with initial
positions (crosses) and final positions (triangles). Lower panels: Temporal
evolution of population fitness. Panels from left to right show increasing
values of population size ($N$), demonstrating increasingly
deterministic adaptive trajectories.](./fig/supplementary/figSI_sim_population_effect){#fig-metropolis-population-effect}

### Main Text Results

Having developed this alternative algorithm for the population dynamics, we
reproduce the results from the main text using this new algorithm. In
particular, Figure 2, 4, and 5 in the main text used synthetic data generated
by the algorithm described in @sec-metropolis. We now show that the same results
can be obtained using the Metropolis-Kimura algorithm.

#### Figure 2 Main Text

![**Evolutionary dynamics on phenotype space with Metropolis-Kimura dynamics**.
(A) Top: Metropolis-like evolutionary dynamics on phenotype space. Each line
represents the trajectory of a lineage as it evolves over time, with crosses and
triangles denoting the initial phenotypic coordinate of a few selected lineages.
Note that trajectories tend to move towards higher fitness values, avoiding low
genotype-to-phenotype density regions. Bottom: Fitness over time of the same
trajectories shown above. (B) The same trajectories shown in (A) overlaid on
different fitness maps determined by different environments. Although the
phenotypic coordinates of the genotypes remain the same (top panels), the
resulting fitness readouts change as the topography of the environment-dependent
fitness landscape changes (bottom panels).](./fig/supplementary/figSI_02_kimura){#fig-02-kimura}

#### Figure 4 Main Text

![**Geometry-informed latent space captures phenotypic structure and improves
reconstruction accuracy**. (A) Latent space coordinates of simulated fitness
profiles colored by lineage, after alignment with the ground truth phenotype
space using Procrustes analysis. The RHVAE better preserves phenotypic
relationships than PCA or vanilla VAE, as evidenced by the highlighted points
(diamond markers). (B) Comparison of all pairwise Euclidean distances between
genotypes in the ground truth phenotypic space versus the different latent
spaces, showing RHVAE better preserves the original distances. Given the large
number of data points and the even larger number of pairwise comparisons, the
data are shown as a smear rather than single points. (C) Reconstruction error
(MSE) comparison showing 2D-RHVAE achieves accuracy comparable to a
10-dimensional PCA model. (D) Metric volume visualization of the RHVAE latent
space (left) and with projected data points (right), revealing regions of high
curvature that correspond to areas of low genotype-phenotype density in the
simulation.](./fig/supplementary/figSI_04_kimura){#fig-04-kimura}

#### Figure 5 Main Text

![**Geometry-informed latent space enables accurate reconstruction of complex
fitness landscapes**. Comparison of ground truth and reconstructed fitness
landscapes across multiple environments. The first row shows examples of the
original simulated fitness landscapes used to generate the data. Subsequent rows
show reconstructions using the RHVAE (second row), VAE (third row), and PCA
(fourth row) models. The RHVAE accurately captures the underlying topography,
including the number and relative positions of fitness peaks. While the VAE
captures general landscape shapes, it lacks a geometric metric to define
prediction reliability regions. PCA fails to represent the nonlinear structure
of the landscapes, demonstrating the limitations of linear dimensionality
reduction for complex fitness landscape
reconstruction.](./fig/supplementary/figSI_05_kimura){#fig-05-kimura}